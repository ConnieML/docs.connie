"use strict";(self.webpackChunkflex_project_template_docs=self.webpackChunkflex_project_template_docs||[]).push([[8505],{27299:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>c,frontMatter:()=>n,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"developers/building/template-utilities/task-attribute-updates","title":"Task attribute updates","description":"Location: plugin-flex-ts-template-v2/src/utils/serverless/TaskRouter/TaskRouterService.ts","source":"@site/docs/developers/building/template-utilities/task-attribute-updates.md","sourceDirName":"developers/building/template-utilities","slug":"/developers/building/template-utilities/task-attribute-updates","permalink":"/developers/building/template-utilities/task-attribute-updates","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Task attribute updates"},"sidebar":"developer","previous":{"title":"Shared Sync client","permalink":"/developers/building/template-utilities/shared-sync-client"},"next":{"title":"Terraform","permalink":"/developers/building/template-utilities/terraform"}}');var i=s(74848),r=s(28453);const n={title:"Task attribute updates"},o=void 0,u={},d=[{value:"Updating task attributes",id:"updating-task-attributes",level:2},{value:"Deferred updates",id:"deferred-updates",level:2}];function l(e){const t={code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Location: ",(0,i.jsx)(t.code,{children:"plugin-flex-ts-template-v2/src/utils/serverless/TaskRouter/TaskRouterService.ts"})]}),"\n",(0,i.jsx)(t.p,{children:"Flex provides a few methods out-of-the-box to modify task attributes. However, these methods do not take in to consideration the fact that multiple features may wish to change attributes at the same time, such as in response to an action or event. Unfortunately, using the out-of-box methods can hit race conditions resulting in lost attributes."}),"\n",(0,i.jsxs)(t.p,{children:["The template provides a much more robust solution for updating task attributes as part of the ",(0,i.jsx)(t.code,{children:"TaskRouterService"}),". This solution eliminates race conditions by using the ",(0,i.jsx)(t.code,{children:"ETag"})," header supported by TaskRouter, and provides improved performance with optional deferred updates."]}),"\n",(0,i.jsx)(t.h2,{id:"updating-task-attributes",children:"Updating task attributes"}),"\n",(0,i.jsxs)(t.p,{children:["You can use the ",(0,i.jsx)(t.code,{children:"updateTaskAttributes"})," function of ",(0,i.jsx)(t.code,{children:"TaskRouterService"})," to robustly update task attributes. Here is an example implementation:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'const attributes = {\n  my_custom_attribute: "Hello world",\n};\n\ntry {\n  await TaskRouterService.updateTaskAttributes(taskSid, attributes);\n} catch (error) {\n  // Handle failure to update task attributes\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"The function will merge the provided attributes with the rest of the task attributes and submit the change to the TaskRouter API. If a conflict is reported due to a race condition, the function will re-fetch the latest attributes, re-merge the provided attributes, and try again until successful."}),"\n",(0,i.jsx)(t.h2,{id:"deferred-updates",children:"Deferred updates"}),"\n",(0,i.jsx)(t.p,{children:"It is a common occurrence for multiple features to wish to update task attributes in response to a common event, such as completing the task. However, if multiple features are updating attributes at the same time, this results in excessive API calls, and increases the chance of retries being needed to resolve racing updates. Deferred updates are intended as a solution to this problem."}),"\n",(0,i.jsxs)(t.p,{children:["Deferred updates are flushed out to TaskRouter when either a non-deferred update occurs, or when the ",(0,i.jsx)(t.code,{children:"CompleteTask"})," action is invoked."]}),"\n",(0,i.jsxs)(t.p,{children:["To submit a task attribute update that can be deferred, an optional third parameter can be provided to the ",(0,i.jsx)(t.code,{children:"updateTaskAttributes"})," function as follows:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"// Setting the third parameter to `true` indicates that it can wait to be submitted until either a non-deferred update occurs, or the `CompleteTask` action is invoked.\nawait TaskRouterService.updateTaskAttributes(taskSid, attributes, true);\n"})})]})}function c(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>n,x:()=>o});var a=s(96540);const i={},r=a.createContext(i);function n(e){const t=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:n(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);