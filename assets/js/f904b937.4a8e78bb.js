"use strict";(self.webpackChunkflex_project_template_docs=self.webpackChunkflex_project_template_docs||[]).push([[3841],{2789:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>c,frontMatter:()=>s,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"developers/building/deployment/ci-deployment","title":"CI deployment","description":"The template includes several GitHub Actions workflows, which provides a full deployment pipeline out-of-the-box. While these workflows as written are specific to GitHub, they could be adapted to other solutions.","source":"@site/docs/developers/building/deployment/00_ci-deployment.md","sourceDirName":"developers/building/deployment","slug":"/developers/building/deployment/ci-deployment","permalink":"/developers/building/deployment/ci-deployment","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"title":"CI deployment"},"sidebar":"developer","previous":{"title":"Terraform","permalink":"/developers/building/template-utilities/terraform"},"next":{"title":"Local deployment","permalink":"/developers/building/deployment/local-deployment"}}');var o=r(74848),i=r(28453);const s={title:"CI deployment"},l=void 0,d={},a=[{value:"Deploy ConnieRTC",id:"deploy-conniertc",level:2},{value:"Options",id:"options",level:3},{value:"environment (Environment to use for deployment)",id:"environment-environment-to-use-for-deployment",level:4},{value:"deploy_terraform (Deploy Terraform?)",id:"deploy_terraform-deploy-terraform",level:4},{value:"initial_release (Is this the first release to the environment?)",id:"initial_release-is-this-the-first-release-to-the-environment",level:4},{value:"overwrite_config (Overwrite config set by Admin UI Panel?)",id:"overwrite_config-overwrite-config-set-by-admin-ui-panel",level:4},{value:"Merge deploy example",id:"merge-deploy-example",level:2},{value:"Terraform",id:"terraform",level:2},{value:"Terraform deploy",id:"terraform-deploy",level:3},{value:"Terraform delete state",id:"terraform-delete-state",level:3},{value:"Docs deploy",id:"docs-deploy",level:2},{value:"Checks",id:"checks",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"The template includes several GitHub Actions workflows, which provides a full deployment pipeline out-of-the-box. While these workflows as written are specific to GitHub, they could be adapted to other solutions."}),"\n",(0,o.jsx)(t.h2,{id:"deploy-conniertc",children:"Deploy ConnieRTC"}),"\n",(0,o.jsxs)(t.p,{children:["Location: ",(0,o.jsx)(t.code,{children:".github/workflows/flex_deploy.yaml"})]}),"\n",(0,o.jsx)(t.p,{children:"This workflow encapsulates the logic for deploying the entire template. It can be invoked manually via GitHub, or by calling from another workflow. It performs the following:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Injects GitHub environment secrets and variables into the runner's environment, making them available to the setup script"}),"\n",(0,o.jsx)(t.li,{children:"Validates that the environment secrets and variables required for deployment are present and valid, and that the ConnieRTC account is configured properly"}),"\n",(0,o.jsxs)(t.li,{children:["Sets the ",(0,o.jsx)(t.code,{children:"ENVIRONMENT"})," variable based on the selected environment"]}),"\n",(0,o.jsxs)(t.li,{children:["Deploys all serverless services and add-ons","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["As part of this process, the setup script executes in order to generate the environment file used by the deployment. See ",(0,o.jsx)(t.a,{href:"/developers/building/template-utilities/configuration#serverless-configuration",children:"serverless configuration"})," for details on how this works."]}),"\n",(0,o.jsxs)(t.li,{children:["To deploy add-ons, ",(0,o.jsx)(t.code,{children:"npm run deploy-addons"})," is executed from the top level directory."]}),"\n",(0,o.jsxs)(t.li,{children:["Within the serverless package(s), the ",(0,o.jsx)(t.code,{children:"npm run deploy"})," command is executed to perform the deployment. This is performed after deploying add-ons."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["Deploys Terraform","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["If the option to deploy Terraform was selected, the ",(0,o.jsx)(t.a,{href:"#terraform-deploy",children:"Terraform deploy"})," workflow is executed to deploy resources using Terraform."]}),"\n",(0,o.jsx)(t.li,{children:"If this is the first time the template has been deployed, there is a chicken-egg problem with the serverless and Terraform deployments (Terraform wants the serverless service to exist, but the serverless service wants the dependencies deployed by Terraform to exist). To solve this, when the initial release option is selected, the serverless services are deployed twice: Once before Terraform (in a state where some dependencies are missing), then again after Terraform (once the dependencies have been deployed)."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["Deploys the ConnieRTC configuration by running ",(0,o.jsx)(t.code,{children:"npm run deploy"})," from the ",(0,o.jsx)(t.code,{children:"flex-config"})," package"]}),"\n",(0,o.jsx)(t.li,{children:"Deploys and releases the ConnieRTC plugin using the Twilio CLI"}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"options",children:"Options"}),"\n",(0,o.jsx)(t.h4,{id:"environment-environment-to-use-for-deployment",children:"environment (Environment to use for deployment)"}),"\n",(0,o.jsx)(t.p,{children:"Selects the configured GitHub environment to deploy. The environment defines the account to deploy to, along with credentials and (optionally) some settings."}),"\n",(0,o.jsx)(t.h4,{id:"deploy_terraform-deploy-terraform",children:"deploy_terraform (Deploy Terraform?)"}),"\n",(0,o.jsx)(t.p,{children:"Whether or not the Terraform configuration within the template should be deployed. The template includes supporting objects for features, such as TaskRouter workflows and Studio flows, that can be automatically deployed and managed via Terraform. However, any existing resources with the same name will be overwritten when the deployment occurs."}),"\n",(0,o.jsx)(t.h4,{id:"initial_release-is-this-the-first-release-to-the-environment",children:"initial_release (Is this the first release to the environment?)"}),"\n",(0,o.jsx)(t.p,{children:'If the template has never been deployed to the target account, and "Deploy Terraform" is selected, you must also select this option. If this is the first time the template has been deployed, there is a chicken-egg problem with the serverless and Terraform deployments (Terraform wants the serverless service to exist, but the serverless service wants the dependencies deployed by Terraform to exist). To solve this, when the initial release option is selected, the serverless services are deployed twice: Once before Terraform (in a state where some dependencies are missing), then again after Terraform (once the dependencies have been deployed).'}),"\n",(0,o.jsx)(t.h4,{id:"overwrite_config-overwrite-config-set-by-admin-ui-panel",children:"overwrite_config (Overwrite config set by Admin UI Panel?)"}),"\n",(0,o.jsx)(t.p,{children:"Determines whether the source of truth for configuration is the repository or the configuration made via the template's included admin UI. If the repository is the source of truth, select this option, so that any updates made via the repository are deployed. If the admin UI is the source of truth, deselect this option so that only net-new configuration options are added, and existing settings are not overwritten."}),"\n",(0,o.jsx)(t.h2,{id:"merge-deploy-example",children:"Merge deploy example"}),"\n",(0,o.jsxs)(t.p,{children:["Location: ",(0,o.jsx)(t.code,{children:".github/examples/merge_deploy.yaml"})]}),"\n",(0,o.jsxs)(t.p,{children:["This workflow is an example of how you can call the ",(0,o.jsx)(t.a,{href:"#deploy-flex",children:"Deploy ConnieRTC"})," workflow in response to events. This example will deploy whenever a commit is pushed to the ",(0,o.jsx)(t.code,{children:"main"})," or ",(0,o.jsx)(t.code,{children:"develop"})," branches, using the 'production' environment when pushing to the main branch, or 'dev' environment when pushing to the develop branch."]}),"\n",(0,o.jsxs)(t.p,{children:["To use this workflow, move it to the ",(0,o.jsx)(t.code,{children:".github/workflows"})," directory and make the necessary adjustments for your use case."]}),"\n",(0,o.jsx)(t.h2,{id:"terraform",children:"Terraform"}),"\n",(0,o.jsx)(t.h3,{id:"terraform-deploy",children:"Terraform deploy"}),"\n",(0,o.jsxs)(t.p,{children:["Location: ",(0,o.jsx)(t.code,{children:".github/workflows/terraform_deploy.yaml"})]}),"\n",(0,o.jsxs)(t.p,{children:["This workflow encapsulates the logic for deploying Terraform. It pulls the Terraform state from a serverless asset, imports it to the runner's Terraform instance, runs ",(0,o.jsx)(t.code,{children:"terraform apply"}),", then updates the state serverless asset with the new state after apply."]}),"\n",(0,o.jsx)(t.h3,{id:"terraform-delete-state",children:"Terraform delete state"}),"\n",(0,o.jsxs)(t.p,{children:["Location: ",(0,o.jsx)(t.code,{children:".github/workflows/terraform_delete.yaml"})]}),"\n",(0,o.jsx)(t.p,{children:"This workflow removes the serverless asset containing the Terraform state."}),"\n",(0,o.jsx)(t.h2,{id:"docs-deploy",children:"Docs deploy"}),"\n",(0,o.jsxs)(t.p,{children:["Location: ",(0,o.jsx)(t.code,{children:".github/workflows/deploy_docs_gh_pages.yaml"})]}),"\n",(0,o.jsxs)(t.p,{children:["This workflow builds and deploys the Docusaurus site to GitHub Pages if the repository variable ",(0,o.jsx)(t.code,{children:"DEPLOY_DOCS"})," is set to ",(0,o.jsx)(t.code,{children:"true"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"checks",children:"Checks"}),"\n",(0,o.jsxs)(t.p,{children:["Location: ",(0,o.jsx)(t.code,{children:".github/workflows/checks.yaml"})]}),"\n",(0,o.jsx)(t.p,{children:"This workflow executes whenever a pull request is opened. It performs two primary functions:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Runs ",(0,o.jsx)(t.a,{href:"/developers/building/template-utilities/eslint",children:"ESLint"})," and posts a comment with results indicating any warnings or errors"]}),"\n",(0,o.jsxs)(t.li,{children:["Executes ",(0,o.jsx)(t.code,{children:"npm run test:ci"})," to run unit tests, and publishes the results"]}),"\n"]}),"\n",(0,o.jsx)(t.admonition,{title:"Fork note",type:"tip",children:(0,o.jsx)(t.p,{children:"This workflow will fail when a pull request is opened from a fork. This is due to forks not having access to the GitHub token, preventing the lint results comment from posting. However, the checks will still run, and you can see their results in the action logs."})})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},28453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>l});var n=r(96540);const o={},i=n.createContext(o);function s(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);