"use strict";(self.webpackChunkflex_project_template_docs=self.webpackChunkflex_project_template_docs||[]).push([[3692],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var r=i(96540);const t={},s=r.createContext(t);function l(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(s.Provider,{value:n},e.children)}},42796:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"developers/building/feature-management/channels/voice/voicemail/email-providers/sendgrid-setup","title":"SendGrid Email Integration Setup","description":"This guide helps you implement SendGrid integration to send automated email notifications when callers leave voicemails in your Connie system. Voicemail audio files will be automatically emailed to admin mailboxes for compliance and record-keeping.","source":"@site/docs/developers/building/feature-management/channels/voice/voicemail/email-providers/sendgrid-setup.md","sourceDirName":"developers/building/feature-management/channels/voice/voicemail/email-providers","slug":"/developers/building/feature-management/channels/voice/voicemail/email-providers/sendgrid-setup","permalink":"/developers/building/feature-management/channels/voice/voicemail/email-providers/sendgrid-setup","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"SendGrid Setup","sidebar_position":2,"title":"SendGrid Email Integration Setup"},"sidebar":"developer","previous":{"title":"Mailgun Setup","permalink":"/developers/building/feature-management/channels/voice/voicemail/email-providers/mailgun-setup"},"next":{"title":"Advanced Email Config","permalink":"/developers/building/feature-management/channels/voice/voicemail/email-providers/advanced-email-config"}}');var t=i(74848),s=i(28453);const l={sidebar_label:"SendGrid Setup",sidebar_position:2,title:"SendGrid Email Integration Setup"},o="SendGrid Email Setup for Voicemail Notifications",d={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Step 1: Set Up Your SendGrid Account",id:"step-1-set-up-your-sendgrid-account",level:2},{value:"Sign Up for SendGrid",id:"sign-up-for-sendgrid",level:3},{value:"Verify Your Sender Identity",id:"verify-your-sender-identity",level:3},{value:"Configure DNS Records (Domain Authentication)",id:"configure-dns-records-domain-authentication",level:3},{value:"Step 2: Get Your SendGrid API Key",id:"step-2-get-your-sendgrid-api-key",level:2},{value:"Generate API Key",id:"generate-api-key",level:3},{value:"Test Your Setup",id:"test-your-setup",level:3},{value:"Step 3: Configure Twilio Studio Flow",id:"step-3-configure-twilio-studio-flow",level:2},{value:"Import the Studio Flow",id:"import-the-studio-flow",level:3},{value:"Step 4: Create the Email Function",id:"step-4-create-the-email-function",level:2},{value:"Set Up Twilio Functions",id:"set-up-twilio-functions",level:3},{value:"Add the Function Code",id:"add-the-function-code",level:3},{value:"Configure Environment Variables",id:"configure-environment-variables",level:3},{value:"Add Dependencies",id:"add-dependencies",level:3},{value:"Deploy the Function",id:"deploy-the-function",level:3},{value:"Step 5: Update Your Studio Flow",id:"step-5-update-your-studio-flow",level:2},{value:"Connect the Function",id:"connect-the-function",level:3},{value:"Connect to Your Phone Number",id:"connect-to-your-phone-number",level:3},{value:"Step 6: Test Your Setup",id:"step-6-test-your-setup",level:2},{value:"Test the Complete Flow",id:"test-the-complete-flow",level:3},{value:"Troubleshooting Common Issues",id:"troubleshooting-common-issues",level:3},{value:"Advanced Configuration",id:"advanced-configuration",level:2},{value:"Email Templates",id:"email-templates",level:3},{value:"Multiple Recipients",id:"multiple-recipients",level:3},{value:"Webhook Event Handling",id:"webhook-event-handling",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"API Key Management",id:"api-key-management",level:3},{value:"Email Security",id:"email-security",level:3},{value:"Data Privacy",id:"data-privacy",level:3},{value:"Monitoring and Maintenance",id:"monitoring-and-maintenance",level:2},{value:"SendGrid Dashboard Monitoring",id:"sendgrid-dashboard-monitoring",level:3},{value:"Regular Maintenance Tasks",id:"regular-maintenance-tasks",level:3},{value:"Performance Optimization",id:"performance-optimization",level:3},{value:"Cost Management",id:"cost-management",level:2},{value:"SendGrid Pricing Tiers",id:"sendgrid-pricing-tiers",level:3},{value:"Cost Optimization Tips",id:"cost-optimization-tips",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Additional Features",id:"additional-features",level:3},{value:"Scaling Considerations",id:"scaling-considerations",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"sendgrid-email-setup-for-voicemail-notifications",children:"SendGrid Email Setup for Voicemail Notifications"})}),"\n",(0,t.jsx)(n.p,{children:"This guide helps you implement SendGrid integration to send automated email notifications when callers leave voicemails in your Connie system. Voicemail audio files will be automatically emailed to admin mailboxes for compliance and record-keeping."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Twilio account with Flex enabled and a phone number configured"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 SendGrid account (free tier available)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 A domain name you control (or subdomain)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Access to your domain's DNS settings"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Basic knowledge of JSON for Studio imports and Node.js for Functions"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,t.jsx)(n.p,{children:"This implementation creates an automated workflow where:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Caller leaves voicemail"})," \u2192 Recorded in Twilio Studio"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Voicemail triggers serverless function"})," \u2192 Processes recording"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Function calls SendGrid API"})," \u2192 Sends email with attachment"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Admin receives notification"})," \u2192 With audio file attached"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Original voicemail task"})," \u2192 Routes to Flex agents normally"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The system maintains compliance records while keeping your normal workflow intact."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-1-set-up-your-sendgrid-account",children:"Step 1: Set Up Your SendGrid Account"}),"\n",(0,t.jsx)(n.h3,{id:"sign-up-for-sendgrid",children:"Sign Up for SendGrid"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.a,{href:"https://sendgrid.com",children:"sendgrid.com"})," and sign up for a free account"]}),"\n",(0,t.jsx)(n.li,{children:"Verify your email address and complete account setup"}),"\n",(0,t.jsx)(n.li,{children:"Navigate to the SendGrid dashboard"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"verify-your-sender-identity",children:"Verify Your Sender Identity"}),"\n",(0,t.jsx)(n.p,{children:"SendGrid requires sender verification for email delivery. You have two options:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Option A: Domain Authentication (Recommended)"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.strong,{children:"Settings"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Sender Authentication"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Domain Authentication"})]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Authenticate Your Domain"})]}),"\n",(0,t.jsxs)(n.li,{children:["Enter your domain (e.g., ",(0,t.jsx)(n.code,{children:"helpinghand.org"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Choose your DNS host provider"}),"\n",(0,t.jsx)(n.li,{children:"Add the provided DNS records to your domain"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Option B: Single Sender Verification"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.strong,{children:"Settings"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Sender Authentication"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Single Sender Verification"})]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Create New Sender"})]}),"\n",(0,t.jsx)(n.li,{children:"Fill in sender details (name, email, address)"}),"\n",(0,t.jsx)(n.li,{children:"Verify the email address"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"configure-dns-records-domain-authentication",children:"Configure DNS Records (Domain Authentication)"}),"\n",(0,t.jsx)(n.p,{children:"If using domain authentication, add these DNS records:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example DNS Setup:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Type: CNAME\nName: s1._domainkey.helpinghand.org\nValue: s1.domainkey.u1234567.wl123.sendgrid.net\n\nType: CNAME  \nName: s2._domainkey.helpinghand.org\nValue: s2.domainkey.u1234567.wl123.sendgrid.net\n\nType: CNAME\nName: em1234.helpinghand.org\nValue: u1234567.wl123.sendgrid.net\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"DNS Propagation",type:"tip",children:(0,t.jsx)(n.p,{children:"DNS changes can take up to 48 hours to propagate. You can check verification status in your SendGrid dashboard."})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-2-get-your-sendgrid-api-key",children:"Step 2: Get Your SendGrid API Key"}),"\n",(0,t.jsx)(n.h3,{id:"generate-api-key",children:"Generate API Key"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In SendGrid dashboard, go to ",(0,t.jsx)(n.strong,{children:"Settings"})," \u2192 ",(0,t.jsx)(n.strong,{children:"API Keys"})]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Create API Key"})]}),"\n",(0,t.jsxs)(n.li,{children:["Choose ",(0,t.jsx)(n.strong,{children:"Restricted Access"})]}),"\n",(0,t.jsx)(n.li,{children:'Give it a name like "Connie Voicemail Notifications"'}),"\n",(0,t.jsxs)(n.li,{children:["Set permissions:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mail Send"}),": Full Access"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mail Settings"}),": Read Access (optional)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Create & View"})]}),"\n",(0,t.jsxs)(n.li,{children:["Copy the generated API key - it starts with ",(0,t.jsx)(n.code,{children:"SG."})]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{title:"Save Your API Key",type:"warning",children:(0,t.jsx)(n.p,{children:"SendGrid only shows the API key once. Save it securely - you won't be able to view it again."})}),"\n",(0,t.jsx)(n.h3,{id:"test-your-setup",children:"Test Your Setup"}),"\n",(0,t.jsx)(n.p,{children:"Send a test email to verify everything works:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In SendGrid dashboard, go to ",(0,t.jsx)(n.strong,{children:"Email API"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Dynamic Templates"})," (optional)"]}),"\n",(0,t.jsx)(n.li,{children:"Or use the API test in your function (Step 4)"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-3-configure-twilio-studio-flow",children:"Step 3: Configure Twilio Studio Flow"}),"\n",(0,t.jsx)(n.h3,{id:"import-the-studio-flow",children:"Import the Studio Flow"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Log into your ",(0,t.jsx)(n.a,{href:"https://console.twilio.com",children:"Twilio Console"})]}),"\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.strong,{children:"Studio"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Flows"})]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Create New Flow"})]}),"\n",(0,t.jsxs)(n.li,{children:["Choose ",(0,t.jsx)(n.strong,{children:"Import from JSON"})]}),"\n",(0,t.jsx)(n.li,{children:"Paste the following flow configuration:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "description": "Connie Voicemail with SendGrid Email Notifications",\n  "states": [\n    {\n      "name": "Trigger",\n      "type": "trigger",\n      "transitions": [\n        { "event": "incomingMessage" },\n        { "next": "greet_and_offer_options", "event": "incomingCall" },\n        { "event": "incomingConversationMessage" },\n        { "event": "incomingRequest" },\n        { "event": "incomingParent" }\n      ],\n      "properties": {\n        "offset": { "x": 0, "y": 0 }\n      }\n    },\n    {\n      "name": "greet_and_offer_options",\n      "type": "say-play",\n      "transitions": [\n        { "next": "gather_input", "event": "audioComplete" }\n      ],\n      "properties": {\n        "offset": { "x": 180, "y": 200 },\n        "loop": 1,\n        "say": "Welcome to our organization. Press 1 to request a callback, 2 to leave a voicemail, or 3 to wait for the next available agent."\n      }\n    },\n    {\n      "name": "gather_input",\n      "type": "gather-input-on-call",\n      "transitions": [\n        { "next": "branch_on_input", "event": "keypress" },\n        { "next": "greet_and_offer_options", "event": "speech" },\n        { "next": "greet_and_offer_options", "event": "timeout" }\n      ],\n      "properties": {\n        "offset": { "x": 180, "y": 450 },\n        "speech_timeout": "auto",\n        "stop_gather": true,\n        "number_of_digits": 1,\n        "timeout": 5\n      }\n    },\n    {\n      "name": "branch_on_input",\n      "type": "split-based-on",\n      "transitions": [\n        {\n          "next": "invalid_option",\n          "event": "noMatch"\n        },\n        {\n          "next": "request_callback",\n          "event": "match",\n          "conditions": [\n            {\n              "friendly_name": "If value equal_to 1",\n              "arguments": [ "{{widgets.gather_input.Digits}}" ],\n              "type": "equal_to",\n              "value": "1"\n            }\n          ]\n        },\n        {\n          "next": "record_voicemail_1",\n          "event": "match",\n          "conditions": [\n            {\n              "friendly_name": "If value equal_to 2",\n              "arguments": [ "{{widgets.gather_input.Digits}}" ],\n              "type": "equal_to",\n              "value": "2"\n            }\n          ]\n        },\n        {\n          "next": "send_to_flex_queue",\n          "event": "match",\n          "conditions": [\n            {\n              "friendly_name": "If value equal_to 3",\n              "arguments": [ "{{widgets.gather_input.Digits}}" ],\n              "type": "equal_to",\n              "value": "3"\n            }\n          ]\n        }\n      ],\n      "properties": {\n        "input": "{{widgets.gather_input.Digits}}",\n        "offset": { "x": 180, "y": 700 }\n      }\n    },\n    {\n      "name": "invalid_option",\n      "type": "say-play",\n      "transitions": [\n        { "next": "greet_and_offer_options", "event": "audioComplete" }\n      ],\n      "properties": {\n        "offset": { "x": 400, "y": 700 },\n        "loop": 1,\n        "say": "Sorry, that was not a valid option. Please try again."\n      }\n    },\n    {\n      "name": "request_callback",\n      "type": "say-play",\n      "transitions": [\n        { "next": "gather_callback_number", "event": "audioComplete" }\n      ],\n      "properties": {\n        "offset": { "x": -200, "y": 1000 },\n        "loop": 1,\n        "say": "Please enter your phone number for callback, followed by the pound key."\n      }\n    },\n    {\n      "name": "gather_callback_number",\n      "type": "gather-input-on-call",\n      "transitions": [\n        { "next": "send_callback_to_flex", "event": "keypress" },\n        { "next": "request_callback", "event": "speech" },\n        { "next": "request_callback", "event": "timeout" }\n      ],\n      "properties": {\n        "offset": { "x": -200, "y": 1250 },\n        "speech_timeout": "auto",\n        "stop_gather": true,\n        "finish_on_key": "#",\n        "timeout": 10\n      }\n    },\n    {\n      "name": "send_callback_to_flex",\n      "type": "send-to-flex",\n      "transitions": [\n        { "event": "callComplete" },\n        { "event": "failedToEnqueue" },\n        { "event": "callFailure" }\n      ],\n      "properties": {\n        "offset": { "x": -200, "y": 1500 },\n        "workflow": "YOUR-WORKFLOW-SID",\n        "channel": "YOUR-CHANNEL-SID",\n        "attributes": "{ \\"type\\": \\"callback_request\\", \\"caller\\": \\"{{trigger.From}}\\", \\"callback_number\\": \\"{{widgets.gather_callback_number.Digits}}\\" }",\n        "priority": "0",\n        "timeout": "3600"\n      }\n    },\n    {\n      "name": "record_voicemail_1",\n      "type": "record-voicemail",\n      "transitions": [\n        { "next": "send_voicemail_to_flex", "event": "recordingComplete" },\n        { "event": "noAudio" },\n        { "event": "hangup" }\n      ],\n      "properties": {\n        "transcribe": true,\n        "offset": { "x": 180, "y": 1000 },\n        "trim": "trim-silence",\n        "play_beep": "true",\n        "recording_status_callback_url": "https://YOUR-FUNCTION-URL.twil.io/sendgrid-voicemail-handler",\n        "timeout": 5,\n        "max_length": 300\n      }\n    },\n    {\n      "name": "send_voicemail_to_flex",\n      "type": "send-to-flex",\n      "transitions": [\n        { "event": "callComplete" },\n        { "event": "failedToEnqueue" },\n        { "event": "callFailure" }\n      ],\n      "properties": {\n        "offset": { "x": 180, "y": 1250 },\n        "workflow": "YOUR-WORKFLOW-SID",\n        "channel": "YOUR-CHANNEL-SID",\n        "attributes": "{ \\"type\\": \\"voicemail\\", \\"recording_url\\": \\"{{widgets.record_voicemail_1.RecordingUrl}}\\", \\"caller\\": \\"{{trigger.From}}\\" }",\n        "priority": "0",\n        "timeout": "3600"\n      }\n    },\n    {\n      "name": "send_to_flex_queue",\n      "type": "send-to-flex",\n      "transitions": [\n        { "event": "callComplete" },\n        { "event": "failedToEnqueue" },\n        { "event": "callFailure" }\n      ],\n      "properties": {\n        "offset": { "x": 600, "y": 1000 },\n        "workflow": "YOUR-WORKFLOW-SID",\n        "channel": "YOUR-CHANNEL-SID",\n        "attributes": "{ \\"type\\": \\"queue_to_flex\\", \\"caller\\": \\"{{trigger.From}}\\" }",\n        "priority": "0",\n        "timeout": "3600"\n      }\n    }\n  ],\n  "initial_state": "Trigger",\n  "flags": {\n    "allow_concurrent_calls": true\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.admonition,{title:"Update Required Values",type:"warning",children:[(0,t.jsx)(n.p,{children:"Before saving the flow, you'll need to update these placeholders:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"YOUR-FUNCTION-URL"})," - Your Twilio Functions domain (Step 4)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"YOUR-WORKFLOW-SID"})," - Your Flex Workflow SID"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"YOUR-CHANNEL-SID"})," - Your Flex Channel SID"]}),"\n"]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-4-create-the-email-function",children:"Step 4: Create the Email Function"}),"\n",(0,t.jsx)(n.h3,{id:"set-up-twilio-functions",children:"Set Up Twilio Functions"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In Twilio Console, go to ",(0,t.jsx)(n.strong,{children:"Functions & Assets"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Services"})]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Create Service"})]}),"\n",(0,t.jsx)(n.li,{children:'Name it "sendgrid-voicemail-handler"'}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Next"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Add Function"})]}),"\n",(0,t.jsxs)(n.li,{children:["Name the function ",(0,t.jsx)(n.code,{children:"/sendgrid-voicemail-handler"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"add-the-function-code",children:"Add the Function Code"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const sgMail = require('@sendgrid/mail');\n\nexports.handler = async function(context, event, callback) {\n  console.log('SendGrid voicemail handler triggered:', event);\n  \n  // Get environment variables\n  const sendGridApiKey = context.SENDGRID_API_KEY;\n  const fromEmail = context.FROM_EMAIL;\n  const adminEmail = context.ADMIN_EMAIL;\n  \n  // Validate required parameters\n  if (!event.RecordingUrl || !event.From) {\n    console.error('Missing required parameters');\n    return callback(null, { success: false, message: 'Missing parameters' });\n  }\n  \n  // Validate environment variables\n  if (!sendGridApiKey || !fromEmail || !adminEmail) {\n    console.error('Missing required environment variables');\n    return callback(null, { success: false, message: 'Missing configuration' });\n  }\n  \n  try {\n    // Set SendGrid API key\n    sgMail.setApiKey(sendGridApiKey);\n    \n    // Download the recording\n    const recordingResponse = await fetch(event.RecordingUrl + '.wav');\n    const recordingBuffer = await recordingResponse.buffer();\n    const recordingBase64 = recordingBuffer.toString('base64');\n    \n    // Prepare email data\n    const msg = {\n      to: adminEmail,\n      from: fromEmail,\n      subject: `New Voicemail from ${event.From}`,\n      text: `A new voicemail has been received from ${event.From}.\\n\\nTimestamp: ${new Date().toLocaleString()}\\nRecording URL: ${event.RecordingUrl}\\n\\nThe voicemail audio file is attached to this email.`,\n      html: `\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n          <h2 style=\"color: #333;\">New Voicemail Received</h2>\n          <div style=\"background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin: 20px 0;\">\n            <p><strong>From:</strong> ${event.From}</p>\n            <p><strong>Timestamp:</strong> ${new Date().toLocaleString()}</p>\n            <p><strong>Recording URL:</strong> <a href=\"${event.RecordingUrl}\" style=\"color: #007bff;\">${event.RecordingUrl}</a></p>\n          </div>\n          <p>The voicemail audio file is attached to this email.</p>\n          <hr style=\"border: none; border-top: 1px solid #eee; margin: 30px 0;\">\n          <p style=\"color: #666; font-size: 14px;\"><em>This is an automated message from your Connie system.</em></p>\n        </div>\n      `,\n      attachments: [\n        {\n          content: recordingBase64,\n          filename: `voicemail_${event.From}_${Date.now()}.wav`,\n          type: 'audio/wav',\n          disposition: 'attachment'\n        }\n      ]\n    };\n    \n    // Send email\n    const result = await sgMail.send(msg);\n    console.log('Email sent successfully via SendGrid:', result[0].statusCode);\n    \n    return callback(null, { \n      success: true, \n      messageId: result[0].headers['x-message-id'],\n      statusCode: result[0].statusCode,\n      message: 'Voicemail email sent successfully via SendGrid' \n    });\n    \n  } catch (error) {\n    console.error('Error sending voicemail email via SendGrid:', error);\n    \n    // Handle SendGrid specific errors\n    if (error.response) {\n      console.error('SendGrid API Error:', error.response.body);\n      return callback(null, { \n        success: false, \n        message: `SendGrid API Error: ${error.response.body.errors?.[0]?.message || error.message}`,\n        statusCode: error.code\n      });\n    }\n    \n    return callback(null, { \n      success: false, \n      message: error.message \n    });\n  }\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"configure-environment-variables",children:"Configure Environment Variables"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In your Function service, go to ",(0,t.jsx)(n.strong,{children:"Settings"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Environment Variables"})]}),"\n",(0,t.jsx)(n.li,{children:"Add these variables:"}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Variable"}),(0,t.jsx)(n.th,{children:"Value"}),(0,t.jsx)(n.th,{children:"Example"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SENDGRID_API_KEY"})}),(0,t.jsx)(n.td,{children:"Your SendGrid API key"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SG.1234567890abcdef..."})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"FROM_EMAIL"})}),(0,t.jsx)(n.td,{children:"Verified sender email"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"noreply@helpinghand.org"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ADMIN_EMAIL"})}),(0,t.jsx)(n.td,{children:"Where to send notifications"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"admin@helpinghand.org"})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"add-dependencies",children:"Add Dependencies"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.strong,{children:"Settings"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Dependencies"})]}),"\n",(0,t.jsx)(n.li,{children:"Add this dependency:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "@sendgrid/mail": "^7.7.0"\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"deploy-the-function",children:"Deploy the Function"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Deploy All"})]}),"\n",(0,t.jsx)(n.li,{children:"Wait for deployment to complete"}),"\n",(0,t.jsxs)(n.li,{children:["Copy your function URL (it will look like: ",(0,t.jsx)(n.code,{children:"https://sendgrid-voicemail-handler-1234.twil.io/sendgrid-voicemail-handler"}),")"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-5-update-your-studio-flow",children:"Step 5: Update Your Studio Flow"}),"\n",(0,t.jsx)(n.h3,{id:"connect-the-function",children:"Connect the Function"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Go back to your Studio Flow"}),"\n",(0,t.jsxs)(n.li,{children:["Edit the ",(0,t.jsx)(n.code,{children:"record_voicemail_1"})," widget"]}),"\n",(0,t.jsxs)(n.li,{children:["Update the ",(0,t.jsx)(n.code,{children:"recording_status_callback_url"})," to your function URL"]}),"\n",(0,t.jsx)(n.li,{children:"Save and publish the flow"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"connect-to-your-phone-number",children:"Connect to Your Phone Number"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In Twilio Console, go to ",(0,t.jsx)(n.strong,{children:"Phone Numbers"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Manage"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Active Numbers"})]}),"\n",(0,t.jsx)(n.li,{children:"Click on your Connie phone number"}),"\n",(0,t.jsxs)(n.li,{children:["In the ",(0,t.jsx)(n.strong,{children:"Voice Configuration"})," section:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Set ",(0,t.jsx)(n.strong,{children:"A call comes in"})," to your new Studio Flow"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Save the configuration"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-6-test-your-setup",children:"Step 6: Test Your Setup"}),"\n",(0,t.jsx)(n.h3,{id:"test-the-complete-flow",children:"Test the Complete Flow"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Call your Connie number"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Press 2"})," when prompted (for voicemail)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Leave a test message"})," and hang up"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Check your admin email"})," - you should receive:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Email notification with voicemail details"}),"\n",(0,t.jsx)(n.li,{children:"Attached .wav audio file"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Check Flex"})," - the voicemail task should appear normally"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"troubleshooting-common-issues",children:"Troubleshooting Common Issues"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"No email received?"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check your SendGrid Activity Feed in the dashboard"}),"\n",(0,t.jsx)(n.li,{children:"Verify your sender identity is authenticated"}),"\n",(0,t.jsx)(n.li,{children:"Confirm API key has Mail Send permissions"}),"\n",(0,t.jsx)(n.li,{children:"Check Function logs for errors"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Email sent but no attachment?"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check Function logs for download errors"}),"\n",(0,t.jsx)(n.li,{children:"Verify the recording URL is accessible"}),"\n",(0,t.jsx)(n.li,{children:"Ensure SendGrid account has attachment permissions"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Authentication errors?"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Verify your API key is correct and has proper permissions"}),"\n",(0,t.jsx)(n.li,{children:"Check that your FROM_EMAIL is verified in SendGrid"}),"\n",(0,t.jsx)(n.li,{children:"Ensure DNS records are properly configured"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Voicemail not routing to Flex?"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check your Workflow and Channel SIDs in the Studio Flow"}),"\n",(0,t.jsx)(n.li,{children:"Verify Flex configuration is correct"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"advanced-configuration",children:"Advanced Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"email-templates",children:"Email Templates"}),"\n",(0,t.jsx)(n.p,{children:"SendGrid supports dynamic templates for better email design:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In SendGrid, go to ",(0,t.jsx)(n.strong,{children:"Email API"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Dynamic Templates"})]}),"\n",(0,t.jsx)(n.li,{children:"Create a new template with your branding"}),"\n",(0,t.jsx)(n.li,{children:"Use template variables for dynamic content:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// In your function, replace the msg object with:\nconst msg = {\n  to: adminEmail,\n  from: fromEmail,\n  templateId: 'd-1234567890abcdef', // Your template ID\n  dynamicTemplateData: {\n    caller_number: event.From,\n    timestamp: new Date().toLocaleString(),\n    recording_url: event.RecordingUrl\n  },\n  attachments: [\n    {\n      content: recordingBase64,\n      filename: `voicemail_${event.From}_${Date.now()}.wav`,\n      type: 'audio/wav',\n      disposition: 'attachment'\n    }\n  ]\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"multiple-recipients",children:"Multiple Recipients"}),"\n",(0,t.jsx)(n.p,{children:"To send notifications to multiple recipients:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// Update the TO field in your function:\nconst msg = {\n  to: [\n    adminEmail,\n    'manager@helpinghand.org',\n    'compliance@helpinghand.org'\n  ],\n  // ... rest of message config\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"webhook-event-handling",children:"Webhook Event Handling"}),"\n",(0,t.jsx)(n.p,{children:"SendGrid can send webhook events for tracking:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["In SendGrid, go to ",(0,t.jsx)(n.strong,{children:"Settings"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Mail Settings"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Event Webhook"})]}),"\n",(0,t.jsxs)(n.li,{children:["Set your endpoint URL: ",(0,t.jsx)(n.code,{children:"https://your-function.twil.io/sendgrid-webhook"})]}),"\n",(0,t.jsx)(n.li,{children:"Select events to track (delivered, opened, clicked, etc.)"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"api-key-management",children:"API Key Management"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use restricted API keys with minimal required permissions"}),"\n",(0,t.jsx)(n.li,{children:"Rotate API keys regularly (quarterly recommended)"}),"\n",(0,t.jsx)(n.li,{children:"Never hardcode API keys in your function code"}),"\n",(0,t.jsx)(n.li,{children:"Store all secrets in Twilio Functions environment variables"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"email-security",children:"Email Security"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Always use verified sender identities"}),"\n",(0,t.jsx)(n.li,{children:"Implement SPF, DKIM, and DMARC records for domain authentication"}),"\n",(0,t.jsx)(n.li,{children:"Monitor for suspicious sending patterns"}),"\n",(0,t.jsx)(n.li,{children:"Use HTTPS for all webhook endpoints"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"data-privacy",children:"Data Privacy"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Limit voicemail retention time"}),"\n",(0,t.jsx)(n.li,{children:"Encrypt attachments if handling sensitive data"}),"\n",(0,t.jsx)(n.li,{children:"Implement access controls for admin emails"}),"\n",(0,t.jsx)(n.li,{children:"Log all email activities for audit purposes"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"monitoring-and-maintenance",children:"Monitoring and Maintenance"}),"\n",(0,t.jsx)(n.h3,{id:"sendgrid-dashboard-monitoring",children:"SendGrid Dashboard Monitoring"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Activity Feed"}),": Track all email activity and delivery status"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Statistics"}),": Monitor sending volume and engagement metrics"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Suppressions"}),": Manage bounced and unsubscribed addresses"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Alerts"}),": Set up notifications for sending issues"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"regular-maintenance-tasks",children:"Regular Maintenance Tasks"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Weekly"}),": Review email delivery statistics"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Monthly"}),": Test the complete voicemail-to-email flow"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Quarterly"}),": Rotate API keys and review access permissions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Annually"}),": Review and update email templates and branding"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Monitor email delivery times and optimize if needed"}),"\n",(0,t.jsx)(n.li,{children:"Review attachment sizes and compress if necessary"}),"\n",(0,t.jsx)(n.li,{children:"Implement error handling and retry logic for failed sends"}),"\n",(0,t.jsx)(n.li,{children:"Set up alerts for function execution failures"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"cost-management",children:"Cost Management"}),"\n",(0,t.jsx)(n.h3,{id:"sendgrid-pricing-tiers",children:"SendGrid Pricing Tiers"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Free Tier"}),": 100 emails/day forever"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Essentials"}),": $14.95/month for 50,000 emails"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pro"}),": $89.95/month for 100,000 emails"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"cost-optimization-tips",children:"Cost Optimization Tips"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Monitor your sending volume in SendGrid dashboard"}),"\n",(0,t.jsx)(n.li,{children:"Remove inactive recipients to reduce bounce rates"}),"\n",(0,t.jsx)(n.li,{children:"Use templates to reduce bandwidth usage"}),"\n",(0,t.jsx)(n.li,{children:"Implement proper error handling to avoid retry costs"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsx)(n.h3,{id:"additional-features",children:"Additional Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SMS Notifications"}),": Add SMS alerts for urgent voicemails"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CRM Integration"}),": Connect with your customer management system"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Analytics Dashboard"}),": Build reporting for voicemail metrics"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Priority Routing"}),": Implement VIP caller detection"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"scaling-considerations",children:"Scaling Considerations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"High Volume"}),": Plan for SendGrid tier upgrades"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Multiple Locations"}),": Consider regional SendGrid accounts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Backup Systems"}),": Implement fallback notification methods"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Load Testing"}),": Test system under peak call volumes"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Your SendGrid-powered voicemail notification system is now ready for production use!"})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);