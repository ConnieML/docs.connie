"use strict";(self.webpackChunkflex_project_template_docs=self.webpackChunkflex_project_template_docs||[]).push([[9065],{28453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>o});var n=s(96540);const r={},a=n.createContext(r);function i(e){const t=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(a.Provider,{value:t},e.children)}},41244:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>h,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"feature-library/chat-transfer","title":"chat-transfer","description":"Important","source":"@site/docs/feature-library/chat-transfer.md","sourceDirName":"feature-library","slug":"/feature-library/chat-transfer","permalink":"/feature-library/chat-transfer","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"sidebar_label":"chat-transfer","title":"chat-transfer"},"sidebar":"tutorialSidebar","previous":{"title":"chat-to-video","permalink":"/feature-library/chat-to-video-escalation"},"next":{"title":"conditional-recording","permalink":"/feature-library/conditional-recording"}}');var r=s(74848),a=s(28453);const i={sidebar_label:"chat-transfer",title:"chat-transfer"},o=void 0,h={},c=[{value:"flex-user-experience",id:"flex-user-experience",level:2},{value:"setup and dependencies",id:"setup-and-dependencies",level:2},{value:"how does it work?",id:"how-does-it-work",level:2},{value:"known issues",id:"known-issues",level:2}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",img:"img",p:"p",strong:"strong",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Important"})}),"\n",(0,r.jsxs)(t.p,{children:["This feature is specifically for ",(0,r.jsx)(t.em,{children:"Programmable Chat"}),", which is deprecated and no longer recommended for new deployments. Chat is now handled by ",(0,r.jsx)(t.em,{children:"Flex Conversations"}),", and the replacement for the chat-transfer feature is ",(0,r.jsx)(t.a,{href:"conversation-transfer",children:"conversation-transfer"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"This feature enables chat users to perform warm and cold transfers to individual agents or queues. It also introduces notifications into the chat channel for users joining or leaving chat, or starting a warm or cold transfer."}),"\n",(0,r.jsx)(t.p,{children:"If using the notification feature it is advised that you copy the custom components over to the customer facing chat react app to be re-used, so the custom messages with message-attributes indicating a notification can be rendered the same as they will be in flex."}),"\n",(0,r.jsx)(t.h2,{id:"flex-user-experience",children:"flex-user-experience"}),"\n",(0,r.jsx)(t.p,{children:"Performing a cold transfer to another worker:"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Chat cold transfer demo",src:s(65999).A+"",width:"1481",height:"859"})}),"\n",(0,r.jsx)(t.p,{children:"Performing a warm transfer to another queue:"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Chat warm transfer demo",src:s(42488).A+"",width:"1481",height:"859"})}),"\n",(0,r.jsx)(t.h2,{id:"setup-and-dependencies",children:"setup and dependencies"}),"\n",(0,r.jsx)(t.p,{children:"To use this feature first some setup needs to take place."}),"\n",(0,r.jsx)(t.p,{children:"this feature creates a task when transferring which copies the attributes of the existing task and places them into the new task to be transferred. When we transfer we only know the target, a worker sid or a queue sid."}),"\n",(0,r.jsx)(t.p,{children:'When creating a task we need to pass it to a TaskRouter workflow and the workflow needs to route it. In the case of a worker sid, this is a single rule as we can use the "known agent routing" option and pass in the variable. In the case of a queue, this is a little more cumbersome as we need to create a rule in the workflow for each queue.'}),"\n",(0,r.jsxs)(t.p,{children:["So we need to setup a workflow, similar to this one ",(0,r.jsx)(t.a,{href:"https://github.com/twilio-professional-services/flex-project-template/blob/main/plugin-flex-ts-template-v2/src/feature-library/chat-transfer/example-taskrouter-workflow.json",children:"here"}),' where the first rule matches any worker selected then we have a rule for each queue in the system. It is recommended to name this "Chat Transfer".']}),"\n",(0,r.jsx)(t.p,{children:"With the workflow setup, we need to update the serverless function environment variable"}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"TWILIO_FLEX_CHAT_TRANSFER_WORKFLOW_SID"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:['with the new workflow sid for the chat transfer. If your workflow name begins with "Chat Transfer", the ',(0,r.jsx)(t.code,{children:"npm install"})," script, ",(0,r.jsx)(t.code,{children:"npm run generate-env"})," script, and the included CI scripts will automatically populate this SID for you."]}),"\n",(0,r.jsx)(t.h2,{id:"how-does-it-work",children:"how does it work?"}),"\n",(0,r.jsx)(t.p,{children:'When enabled, the feature renders a "transfer" button at the top of the TaskCanvas.'}),"\n",(0,r.jsxs)(t.p,{children:["When this button is selected, it invokes the ",(0,r.jsx)(t.a,{href:"https://assets.flex.twilio.com/docs/releases/flex-ui/1.31.2/Actions.html#.ShowDirectory",children:"ShowDirectory"})," action"]}),"\n",(0,r.jsxs)(t.p,{children:["When we select a worker or a queue, it invokes the ",(0,r.jsx)(t.a,{href:"https://assets.flex.twilio.com/docs/releases/flex-ui/1.31.2/Actions.html#.TransferTask",children:"TransferTask"})," action which is replaced with some custom logic that recognizes if the task is a chat task and performs our custom behaviors, otherwise, it does what it does OOTB."]}),"\n",(0,r.jsx)(t.p,{children:"The custom behaviors then handle the orchestration of creating a new task, posting notification messages (normal messages with message attributes that allow the message to be rendered as a notification instead of a conversational message). They also handle the management of the chatOrchestrator and the channel janitor."}),"\n",(0,r.jsx)(t.h2,{id:"known-issues",children:"known issues"}),"\n",(0,r.jsxs)(t.p,{children:["The channel is ended (marked INACTIVE) only by the last agent that received the transfer. That means if ",(0,r.jsx)(t.em,{children:"Agent-A"})," does a warm transfer to ",(0,r.jsx)(t.em,{children:"Agent-B"})," and ",(0,r.jsx)(t.em,{children:"Agent-B"})," completes the task, then it will end the chat for ",(0,r.jsx)(t.em,{children:"Agent-A"})," also. However if ",(0,r.jsx)(t.em,{children:"Agent-A"})," ends the chat first, ",(0,r.jsx)(t.em,{children:"Agent-B"})," can continue the conversation as normal."]}),"\n",(0,r.jsxs)(t.p,{children:["If this is a problem, a solution lies in a ",(0,r.jsx)(t.a,{href:"https://github.com/twilio-professional-services/flex-project-template/blob/main/serverless-functions/src/functions/features/chat-transfer/studio/add-task-to-chat-channel-data.protected.js",children:"provided utility"})," that can be called from the studio flow that creates the first task. After creating the task, you can pass the task Sid and channel sid to this serverless function and it will track the task sid on the channelAttributes. All subsequent task sids are also tracked as either being inflight or closed. This will allow a more robust logic being applied at wrap up to determine whether the task being wrapped up is the last task to wrap up or not but this will have to be implemented manually as the logic for this hasnt been created yet."]})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},42488:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/warm-transfer-f842211a172720b69229b03219407fd0.gif"},65999:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/cold-transfer-107023f3b002d5ceeea739b10e734933.gif"}}]);